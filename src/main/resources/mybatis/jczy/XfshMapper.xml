<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smart119.jczy.dao.XfshDao">

    <select id="get" resultType="com.smart119.jczy.domain.XfshDO">
		SELECT
			t.`XFSH_TYWYSBM`,
			t.`MC`,
			t.`DZMC`,
			t.`GD`,
			t.`DQJD`,
			t.`DQWD`,
			t.`SYKYZTLBDM`,
			t.`SSLD_MC`,
			t.`SSGW_MC`,
			t.`XFJSGWXSLXDM`,
			t.`GWZJ_KD`,
			t.`GW_YL`,
			t.`LL`,
			t.`JSGZJ_KD`,
			t.`CSGZJ_KD`,
			t.`JSCDS_SL`,
			t.`GS_DWMC`,
			t.`GL_DWMC`,
			t.`WB_DWMC`,
			t.`LXR_XM`,
			t.`LXR_LXDH`,
			t.`XFJYJG_TYWYSBM`,
			t.`XZQHDM`,
			t.`JIZ_RQ`,
			t.`QY_RQ`,
			t.`cdate`,
			t.`cperson`,
			t.`status` ,
			dept.`dwmc` XFJYJG,
			d.`name` SYKYZTLB,
			d1.`name` XFJSGWXSLX,
			d5.`name` area,
		  d6.`name` city,
		  d7.`name` province
		FROM
			jczy_xfsh t
			LEFT JOIN sys_dept dept ON t.XFJYJG_TYWYSBM = dept.XFJYJG_TYWYSBM
			left join sys_dict d on t.SYKYZTLBDM=d.`value` and d.description='水源可用状态类别代码'
			left join sys_dict d1 on t.XFJSGWXSLXDM=d1.`value` and d1.description='消防给水管网形式类型代码'
			LEFT JOIN sys_dict d5 ON t.XZQHDM = d5.`value`
			LEFT JOIN sys_dict d6 ON d6.id = d5.parent_id
			LEFT JOIN sys_dict d7 ON d7.id = d6.parent_id
		where t.XFSH_TYWYSBM = #{value}
	</select>

    <select id="list" resultType="com.smart119.jczy.domain.XfshDO">
        SELECT
        t.`XFSH_TYWYSBM`,
        t.`MC`,
        t.`DZMC`,
        t.`GD`,
        t.`DQJD`,
        t.`DQWD`,
        t.`SYKYZTLBDM`,
        t.`SSLD_MC`,
        t.`SSGW_MC`,
        t.`XFJSGWXSLXDM`,
        t.`GWZJ_KD`,
        t.`GW_YL`,
        t.`LL`,
        t.`JSGZJ_KD`,
        t.`CSGZJ_KD`,
        t.`JSCDS_SL`,
        t.`GS_DWMC`,
        t.`GL_DWMC`,
        t.`WB_DWMC`,
        t.`LXR_XM`,
        t.`LXR_LXDH`,
        t.`XFJYJG_TYWYSBM`,
        t.`XZQHDM`,
        t.`JIZ_RQ`,
        t.`QY_RQ`,
        t.`cdate`,
        t.`cperson`,
        t.`status` ,
        dept.`dwmc` XFJYJG,
        d.`name` SYKYZTLB,
        d1.`name` XFJSGWXSLX,
        d5.`name` area,
        d6.`name` city,
        d7.`name` province
        FROM
        jczy_xfsh t
        LEFT JOIN sys_dept dept ON t.XFJYJG_TYWYSBM = dept.XFJYJG_TYWYSBM
        left join sys_dict d on t.SYKYZTLBDM=d.`value` and d.description='水源可用状态类别代码'
        left join sys_dict d1 on t.XFJSGWXSLXDM=d1.`value` and d1.description='消防给水管网形式类型代码'
        LEFT JOIN sys_dict d5 ON t.XZQHDM = d5.`value`
        LEFT JOIN sys_dict d6 ON d6.id = d5.parent_id
        LEFT JOIN sys_dict d7 ON d7.id = d6.parent_id
        <where>
            <if test="xfshTywysbm != null and xfshTywysbm != ''">and t.XFSH_TYWYSBM = #{xfshTywysbm}</if>
            <if test="mc != null and mc != ''">and t.MC like '%${mc}%'</if>
            <if test="dzmc != null and dzmc != ''">and t.DZMC like '%${dzmc}%'</if>
            <if test="gd != null and gd != ''">and t.GD = #{gd}</if>
            <if test="dqjd != null and dqjd != ''">and t.DQJD = #{dqjd}</if>
            <if test="dqwd != null and dqwd != ''">and t.DQWD = #{dqwd}</if>
            <if test="sykyztlbdm != null and sykyztlbdm != ''">and t.SYKYZTLBDM = #{sykyztlbdm}</if>
            <if test="ssldMc != null and ssldMc != ''">and t.SSLD_MC = #{ssldMc}</if>
            <if test="ssgwMc != null and ssgwMc != ''">and t.SSGW_MC = #{ssgwMc}</if>
            <if test="xfjsgwxslxdm != null and xfjsgwxslxdm != ''">and t.XFJSGWXSLXDM = #{xfjsgwxslxdm}</if>
            <if test="gwzjKd != null and gwzjKd != ''">and t.GWZJ_KD = #{gwzjKd}</if>
            <if test="gwYl != null and gwYl != ''">and t.GW_YL = #{gwYl}</if>
            <if test="ll != null and ll != ''">and t.LL = #{ll}</if>
            <if test="jsgzjKd != null and jsgzjKd != ''">and t.JSGZJ_KD = #{jsgzjKd}</if>
            <if test="csgzjKd != null and csgzjKd != ''">and t.CSGZJ_KD = #{csgzjKd}</if>
            <if test="jscdsSl != null and jscdsSl != ''">and t.JSCDS_SL = #{jscdsSl}</if>
            <if test="gsDwmc != null and gsDwmc != ''">and t.GS_DWMC = #{gsDwmc}</if>
            <if test="glDwmc != null and glDwmc != ''">and t.GL_DWMC = #{glDwmc}</if>
            <if test="wbDwmc != null and wbDwmc != ''">and t.WB_DWMC = #{wbDwmc}</if>
            <if test="lxrXm != null and lxrXm != ''">and t.LXR_XM = #{lxrXm}</if>
            <if test="lxrLxdh != null and lxrLxdh != ''">and t.LXR_LXDH = #{lxrLxdh}</if>
            <if test="xfjyjgTywysbm != null and xfjyjgTywysbm != ''">and t.XFJYJG_TYWYSBM = #{xfjyjgTywysbm}</if>
            <if test="deptList != null and deptList.size() > 0">and t.XFJYJG_TYWYSBM in
                <foreach collection="deptList" item="item" index="index" separator="," open="(" close=")">
                    #{item.xfjyjgTywysbm}
                </foreach>
            </if>
            <if test="xzqhdm != null and xzqhdm != ''">and t.XZQHDM = #{xzqhdm}</if>
            <if test="jizRq != null and jizRq != ''">and t.JIZ_RQ = #{jizRq}</if>
            <if test="qyRq != null and qyRq != ''">and t.QY_RQ = #{qyRq}</if>
            <if test="cdate != null and cdate != ''">and t.cdate = #{cdate}</if>
            <if test="cperson != null and cperson != ''">and t.cperson = #{cperson}</if>
            <if test="status != null and status != ''">
                <if test="status == '1' or status == 1">
                    and t.status = '1'
                </if>
                <if test="status != '1' and status != 1">
                    and (t.STATUS = '0' or t.STATUS ='' or t.STATUS is null)
                </if>
            </if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
            <otherwise>
                order by t.cdate desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="count" resultType="int">
        select count(t.XFSH_TYWYSBM) from jczy_xfsh t
        LEFT JOIN sys_dept dept ON t.XFJYJG_TYWYSBM = dept.XFJYJG_TYWYSBM
        left join sys_dict d on t.SYKYZTLBDM=d.`value` and d.description='水源可用状态类别代码'
        left join sys_dict d1 on t.XFJSGWXSLXDM=d1.`value` and d1.description='消防给水管网形式类型代码'
        LEFT JOIN sys_dict d5 ON t.XZQHDM = d5.`value`
        LEFT JOIN sys_dict d6 ON d6.id = d5.parent_id
        LEFT JOIN sys_dict d7 ON d7.id = d6.parent_id
        <where>
            <if test="xfshTywysbm != null and xfshTywysbm != ''">and t.XFSH_TYWYSBM = #{xfshTywysbm}</if>
            <if test="mc != null and mc != ''">and t.MC like '%${mc}%'</if>
            <if test="dzmc != null and dzmc != ''">and t.DZMC like '%${dzmc}%'</if>
            <if test="gd != null and gd != ''">and t.GD = #{gd}</if>
            <if test="dqjd != null and dqjd != ''">and t.DQJD = #{dqjd}</if>
            <if test="dqwd != null and dqwd != ''">and t.DQWD = #{dqwd}</if>
            <if test="sykyztlbdm != null and sykyztlbdm != ''">and t.SYKYZTLBDM = #{sykyztlbdm}</if>
            <if test="ssldMc != null and ssldMc != ''">and t.SSLD_MC = #{ssldMc}</if>
            <if test="ssgwMc != null and ssgwMc != ''">and t.SSGW_MC = #{ssgwMc}</if>
            <if test="xfjsgwxslxdm != null and xfjsgwxslxdm != ''">and t.XFJSGWXSLXDM = #{xfjsgwxslxdm}</if>
            <if test="gwzjKd != null and gwzjKd != ''">and t.GWZJ_KD = #{gwzjKd}</if>
            <if test="gwYl != null and gwYl != ''">and t.GW_YL = #{gwYl}</if>
            <if test="ll != null and ll != ''">and t.LL = #{ll}</if>
            <if test="jsgzjKd != null and jsgzjKd != ''">and t.JSGZJ_KD = #{jsgzjKd}</if>
            <if test="csgzjKd != null and csgzjKd != ''">and t.CSGZJ_KD = #{csgzjKd}</if>
            <if test="jscdsSl != null and jscdsSl != ''">and t.JSCDS_SL = #{jscdsSl}</if>
            <if test="gsDwmc != null and gsDwmc != ''">and t.GS_DWMC = #{gsDwmc}</if>
            <if test="glDwmc != null and glDwmc != ''">and t.GL_DWMC = #{glDwmc}</if>
            <if test="wbDwmc != null and wbDwmc != ''">and t.WB_DWMC = #{wbDwmc}</if>
            <if test="lxrXm != null and lxrXm != ''">and t.LXR_XM = #{lxrXm}</if>
            <if test="lxrLxdh != null and lxrLxdh != ''">and t.LXR_LXDH = #{lxrLxdh}</if>
            <if test="xfjyjgTywysbm != null and xfjyjgTywysbm != ''">and t.XFJYJG_TYWYSBM = #{xfjyjgTywysbm}</if>
            <if test="deptList != null and deptList.size() > 0">and t.XFJYJG_TYWYSBM in
                <foreach collection="deptList" item="item" index="index" separator="," open="(" close=")">
                    #{item.xfjyjgTywysbm}
                </foreach>
            </if>
            <if test="xzqhdm != null and xzqhdm != ''">and t.XZQHDM = #{xzqhdm}</if>
            <if test="jizRq != null and jizRq != ''">and t.JIZ_RQ = #{jizRq}</if>
            <if test="qyRq != null and qyRq != ''">and t.QY_RQ = #{qyRq}</if>
            <if test="cdate != null and cdate != ''">and t.cdate = #{cdate}</if>
            <if test="cperson != null and cperson != ''">and t.cperson = #{cperson}</if>
            <if test="status != null and status != ''">
                <if test="status == '1' or status == 1">
                    and t.status = '1'
                </if>
                <if test="status != '1' and status != 1">
                    and (t.STATUS = '0' or t.STATUS ='' or t.STATUS is null)
                </if>
            </if>
        </where>
    </select>

    <insert id="save" parameterType="com.smart119.jczy.domain.XfshDO">
		insert into jczy_xfsh
		(
			`XFSH_TYWYSBM`,
			`MC`,
			`DZMC`,
			`GD`,
			`DQJD`,
			`DQWD`,
			`SYKYZTLBDM`,
			`SSLD_MC`,
			`SSGW_MC`,
			`XFJSGWXSLXDM`,
			`GWZJ_KD`,
			`GW_YL`,
			`LL`,
			`JSGZJ_KD`,
			`CSGZJ_KD`,
			`JSCDS_SL`,
			`GS_DWMC`,
			`GL_DWMC`,
			`WB_DWMC`,
			`LXR_XM`,
			`LXR_LXDH`,
			`XFJYJG_TYWYSBM`,
			`XZQHDM`,
			`JIZ_RQ`,
			`QY_RQ`,
			`cdate`,
			`cperson`,
			`status`
		)
		values
		(
			#{xfshTywysbm},
			#{mc},
			#{dzmc},
			#{gd},
			#{dqjd},
			#{dqwd},
			#{sykyztlbdm},
			#{ssldMc},
			#{ssgwMc},
			#{xfjsgwxslxdm},
			#{gwzjKd},
			#{gwYl},
			#{ll},
			#{jsgzjKd},
			#{csgzjKd},
			#{jscdsSl},
			#{gsDwmc},
			#{glDwmc},
			#{wbDwmc},
			#{lxrXm},
			#{lxrLxdh},
			#{xfjyjgTywysbm},
			#{xzqhdm},
			#{jizRq},
			#{qyRq},
			#{cdate},
			#{cperson},
			#{status}
		)
	</insert>

    <update id="update" parameterType="com.smart119.jczy.domain.XfshDO">
        update jczy_xfsh
        <set>
            <if test="mc != null">`MC` = #{mc},</if>
            <if test="dzmc != null">`DZMC` = #{dzmc},</if>
            <if test="gd != null">`GD` = #{gd},</if>
            <if test="dqjd != null">`DQJD` = #{dqjd},</if>
            <if test="dqwd != null">`DQWD` = #{dqwd},</if>
            <if test="sykyztlbdm != null">`SYKYZTLBDM` = #{sykyztlbdm},</if>
            <if test="ssldMc != null">`SSLD_MC` = #{ssldMc},</if>
            <if test="ssgwMc != null">`SSGW_MC` = #{ssgwMc},</if>
            <if test="xfjsgwxslxdm != null">`XFJSGWXSLXDM` = #{xfjsgwxslxdm},</if>
            <if test="gwzjKd != null">`GWZJ_KD` = #{gwzjKd},</if>
            <if test="gwYl != null">`GW_YL` = #{gwYl},</if>
            <if test="ll != null">`LL` = #{ll},</if>
            <if test="jsgzjKd != null">`JSGZJ_KD` = #{jsgzjKd},</if>
            <if test="csgzjKd != null">`CSGZJ_KD` = #{csgzjKd},</if>
            <if test="jscdsSl != null">`JSCDS_SL` = #{jscdsSl},</if>
            <if test="gsDwmc != null">`GS_DWMC` = #{gsDwmc},</if>
            <if test="glDwmc != null">`GL_DWMC` = #{glDwmc},</if>
            <if test="wbDwmc != null">`WB_DWMC` = #{wbDwmc},</if>
            <if test="lxrXm != null">`LXR_XM` = #{lxrXm},</if>
            <if test="lxrLxdh != null">`LXR_LXDH` = #{lxrLxdh},</if>
            <if test="xfjyjgTywysbm != null">`XFJYJG_TYWYSBM` = #{xfjyjgTywysbm},</if>
            <if test="xzqhdm != null">`XZQHDM` = #{xzqhdm},</if>
            <if test="jizRq != null">`JIZ_RQ` = #{jizRq},</if>
            <if test="qyRq != null">`QY_RQ` = #{qyRq},</if>
            <if test="cdate != null">`cdate` = #{cdate},</if>
            <if test="cperson != null">`cperson` = #{cperson},</if>
            <if test="status != null">`status` = #{status}</if>
        </set>
        where XFSH_TYWYSBM = #{xfshTywysbm}
    </update>

    <delete id="remove">
		delete from jczy_xfsh where XFSH_TYWYSBM = #{value}
	</delete>

    <update id="updateStatus">
        update jczy_xfsh set status = '1' where XFSH_TYWYSBM = #{xfshTywysbm}
    </update>

    <delete id="batchRemove">
        delete from jczy_xfsh where XFSH_TYWYSBM in
        <foreach item="xfshTywysbm" collection="array" open="(" separator="," close=")">
            #{xfshTywysbm}
        </foreach>
    </delete>

    <select id="getXfshByRange" resultType="com.smart119.jczy.domain.XfshDO">
		SELECT
		t.`XFSH_TYWYSBM`,
		t.`MC`,
		t.`DZMC`,
		t.`GD`,
		t.`DQJD`,
		t.`DQWD`,
		t.`SYKYZTLBDM`,
		t.`SSLD_MC`,
		t.`SSGW_MC`,
		t.`XFJSGWXSLXDM`,
		t.`GWZJ_KD`,
		t.`GW_YL`,
		t.`LL`,
		t.`JSGZJ_KD`,
		t.`CSGZJ_KD`,
		t.`JSCDS_SL`,
		t.`GS_DWMC`,
		t.`GL_DWMC`,
		t.`WB_DWMC`,
		t.`LXR_XM`,
		t.`LXR_LXDH`,
		t.`XFJYJG_TYWYSBM`,
		t.`XZQHDM`,
		t.`JIZ_RQ`,
		t.`QY_RQ`,
		t.`cdate`,
		t.`cperson`,
		t.`status` ,
		dept.`dwmc` XFJYJG,
		d.`name` SYKYZTLB,
		d1.`name` XFJSGWXSLX,
		d5.`name` area,
		d6.`name` city,
		d7.`name` province,
        calculateLineDistance(t.DQJD, t.DQWD, #{jd}, #{wd}) AS distance
		FROM
		jczy_xfsh t
		LEFT JOIN sys_dept dept ON t.XFJYJG_TYWYSBM = dept.XFJYJG_TYWYSBM
		left join sys_dict d on t.SYKYZTLBDM=d.`value` and d.description='水源可用状态类别代码'
		left join sys_dict d1 on t.XFJSGWXSLXDM=d1.`value` and d1.description='消防给水管网形式类型代码'
        LEFT JOIN sys_dict d5 ON t.XZQHDM = d5.`value` and d5.type='XZQHDM' and d5.`value`!=''
		LEFT JOIN sys_dict d6 ON d6.id = d5.parent_id
		LEFT JOIN sys_dict d7 ON d7.id = d6.parent_id
		where (t.status = '0' or t.status = '' or t.status is null)
		HAVING distance <![CDATA[ <= ]]> #{distance}
	</select>

</mapper>
